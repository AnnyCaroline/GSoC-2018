# Céu-Maker: Select device

![](https://uploaddeimagens.com.br/images/001/431/237/full/ceu-maker-select-device.png?1527049668)

A GUI application that shows up the connected Arduino boards and allows user to select one. It was developed to be used together with Céu-Maker's [make-arduino.bat](https://github.com/fsantanna/ceu-maker/blob/master/ceu-maker/run/make-arduino.bat) as follows:

1. the ```make-arduino.bat``` is executed;
2. ```make-arduino.bat``` execute the ```SelectDevice.exe``` to define 3 variables;
3. if there are at least one arduino connected, the ```SelectDevice.exe``` prints in the command line the definitions (the &lt;port>, &lt;cpu> and &lt;board> correspond with the selected board): 
```
set ARD_BOARD="--board arduino:avr:<board><cpu>"
set ARD_PORT="--port <port>"
```
4. ```make-arduino.bat``` uses the ```ARD_BOARD``` and the ```ARD_PORT``` as parameters to compile a Céu-Arduino application.

## Inspiration 
The Arduino IDE uses the file *arduino-1.8.3\hardware\arduino\avr\boards.txt* to identify ports and boards. With a VID/PID combination we can identify the USB device that is plugged and then search in this file for more information, such as name of the board. 

## Debug and Release
In the [*SelectDevice/Form1.cs*](https://github.com/AnnyCaroline/ceu-maker-gsoc/blob/master/SelectDevice/SelectDevice/Form1.cs), we can find blocks of code using ```#if DEBUG```:

```
#if DEBUG
    string text = System.IO.File.ReadAllText(@"C:\Users\AnnyC\Desktop\ceu-maker\ceu-maker\arduino-1.8.3\hardware\arduino\avr\boards.txt");
#else
    string text = System.IO.File.ReadAllText(@"..\arduino-1.8.3\hardware\arduino\avr\boards.txt");
#endif
```
The above code was included to facilitate the location of *boards.txt* file in develop stage. If you're a developer, change the file path in the second line.  
For release, assume that the exe is located in the [same folder of *make-arduino.bat*](https://github.com/AnnyCaroline/ceu-maker/tree/master/ceu-maker/run). 

```
if (this.counter <= 0)
{
    #if (!DEBUG)
        this.Close();
    #endif
}
```
If no board is connected, the application ends and let the *make-arduino.bat* handle it. In practice, the last selected board/port in Arduino IDE will be chosen. This may be a desirable behavior for a workaround solution, in the event that this application fails to recognize the board. This also may be useful if the end-user want to use a board from a diferent package or arch (currently, this program only recognizes boards from package "arduino" and arch "avr").

It's important to note that the application only closes in release mode. In debug we choose to omit this behavior to facilitate the tests. 

## Release
To create a new release version, make sure to move the exe generated by the IDE from *SelectDevices/bin/Release/* to *ceu-maker/ceu-maker/run*

## Dev notes
This app was developed using Visual Studio Community 2015 and only supports devices from package "arduino" and arch "avr".

## References and links
- How does Arduino IDE 'Get Board Info'?  
https://arduino.stackexchange.com/questions/39137/how-does-arduino-ide-get-board-info
- How to obtain an USB VID/PID for your project:  
https://www.voti.nl/docs/usb-pid.html
- Notes about executing Arduino IDE via command line:
https://github.com/arduino/Arduino/blob/master/build/shared/manpage.adoc
- Explanation about package, arch and board in command line --board:  
https://forum.arduino.cc/index.php?topic=366484.0
- Arduino IDE 1.5 3rd party Hardware specification
https://github.com/arduino/arduino/wiki/arduino-ide-1.5-3rd-party-hardware-specification