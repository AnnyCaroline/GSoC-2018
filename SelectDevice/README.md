# Céu-Maker: Select device

![](https://uploaddeimagens.com.br/images/001/431/237/full/ceu-maker-select-device.png?1527049668)

A GUI application that shows up the connected Arduino boards and allows user to select one. It was developed to be used together with Céu-Maker's [make-arduino.bat](https://github.com/fsantanna/ceu-maker/blob/master/ceu-maker/run/make-arduino.bat) as follows:

1. the ```make-arduino.bat``` is executed;
2. ```make-arduino.bat``` execute the ```SelectDevice.exe``` to define two variables;
3. if there are more than one arduino connected, the ```SelectDevice.exe``` prints in the command line the definitions (the &lt;port> and &lt;board> correspond with the selected board): 
```
set ARD_BOARD="--board arduino:avr:<board>"
set ARD_PORT="--port <port>"
```
4. ```make-arduino.bat``` uses the ```ARD_BOARD``` and the ```ARD_PORT``` as parameters to compile a Céu-Arduino aplication.

## Inspiration 
The Arduino IDE uses the file *arduino-1.8.3\hardware\arduino\avr\boards.txt* to identify ports and boards. With a VID/PID combination we can identify the USB device that is plugged and then search in this file for more information, such as name of the board and SN. 

## Debug and Release
In the *SelectDevice/Form1.cs*, we can find blocks of code using ```#if DEBUG```:

```
#if DEBUG
    string text = System.IO.File.ReadAllText(@"C:\Users\AnnyC\Desktop\ceu-maker\ceu-maker\arduino-1.8.3\hardware\arduino\avr\boards.txt");
#else
    string text = System.IO.File.ReadAllText(@"..\arduino-1.8.3\hardware\arduino\avr\boards.txt");
#endif
```
The above code was included to facilitate the location of *boards.txt* file in develop stage. If you're a developer, change the file path in the second line.  
For release, assume that the exe is located in the same folder of *make-arduino.bat*. 

```
if (this.counter <= 1)
{
    #if (!DEBUG)
        this.Close();
    #endif
}
```
There is no need to select a board if only one is connected. Because of that, the application ends before the grafical interface appears to the user and let the upcoming commands in *make-arduino.bat* deals with it — in practice, the last selected board/port in Arduino IDE will be choosen. If no board is connected, the application also ends and let the *make-arduino.bat* display its error messages.  
Note that this behavior only occurs in release mode. In debug we choose to ommit this behavior to facilitate the tests. 

## Release
To create a new release version, make sure to move the exe generated by the IDE from *SelectDevices/bin/Release/* to *ceu-maker/ceu-maker/run*

## Dev notes
This app was developed using Visual Studio Community 2015 and only supports devices from package "arduino" and arch "avr".

## References and links
- How to obtain an USB VID/PID for your project:  
https://www.voti.nl/docs/usb-pid.html
- Explanation about package, arch and board in command line --board:  
https://forum.arduino.cc/index.php?topic=366484.0
